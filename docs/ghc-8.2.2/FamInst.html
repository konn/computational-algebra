<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>FamInst</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/FamInst.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">ghc-8.2.2: The GHC API</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">FamInst</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Injectivity</a></li></ul></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">type</span> <a href="#t:FamInstEnvs">FamInstEnvs</a> = (<a href="FamInstEnv.html#t:FamInstEnv">FamInstEnv</a>, <a href="FamInstEnv.html#t:FamInstEnv">FamInstEnv</a>)</li><li class="src short"><a href="#v:tcGetFamInstEnvs">tcGetFamInstEnvs</a> :: <a href="TcRnTypes.html#t:TcM">TcM</a> <a href="FamInst.html#t:FamInstEnvs">FamInstEnvs</a></li><li class="src short"><a href="#v:checkFamInstConsistency">checkFamInstConsistency</a> :: [<a href="Module.html#t:Module">Module</a>] -&gt; [<a href="Module.html#t:Module">Module</a>] -&gt; <a href="TcRnTypes.html#t:TcM">TcM</a> <a href="TcRnTypes.html#t:TcGblEnv">TcGblEnv</a></li><li class="src short"><a href="#v:tcExtendLocalFamInstEnv">tcExtendLocalFamInstEnv</a> :: [<a href="FamInstEnv.html#t:FamInst">FamInst</a>] -&gt; <a href="TcRnTypes.html#t:TcM">TcM</a> a -&gt; <a href="TcRnTypes.html#t:TcM">TcM</a> a</li><li class="src short"><a href="#v:tcLookupDataFamInst">tcLookupDataFamInst</a> :: <a href="FamInst.html#t:FamInstEnvs">FamInstEnvs</a> -&gt; <a href="TyCon.html#t:TyCon">TyCon</a> -&gt; [<a href="TcType.html#t:TcType">TcType</a>] -&gt; (<a href="TyCon.html#t:TyCon">TyCon</a>, [<a href="TcType.html#t:TcType">TcType</a>], <a href="Coercion.html#t:Coercion">Coercion</a>)</li><li class="src short"><a href="#v:tcLookupDataFamInst_maybe">tcLookupDataFamInst_maybe</a> :: <a href="FamInst.html#t:FamInstEnvs">FamInstEnvs</a> -&gt; <a href="TyCon.html#t:TyCon">TyCon</a> -&gt; [<a href="TcType.html#t:TcType">TcType</a>] -&gt; <a href="../base-4.10.1.0/Data-Maybe.html#t:Maybe">Maybe</a> (<a href="TyCon.html#t:TyCon">TyCon</a>, [<a href="TcType.html#t:TcType">TcType</a>], <a href="Coercion.html#t:Coercion">Coercion</a>)</li><li class="src short"><a href="#v:tcInstNewTyCon_maybe">tcInstNewTyCon_maybe</a> :: <a href="TyCon.html#t:TyCon">TyCon</a> -&gt; [<a href="TcType.html#t:TcType">TcType</a>] -&gt; <a href="../base-4.10.1.0/Data-Maybe.html#t:Maybe">Maybe</a> (<a href="TcType.html#t:TcType">TcType</a>, <a href="TcEvidence.html#t:TcCoercion">TcCoercion</a>)</li><li class="src short"><a href="#v:tcTopNormaliseNewTypeTF_maybe">tcTopNormaliseNewTypeTF_maybe</a> :: <a href="FamInst.html#t:FamInstEnvs">FamInstEnvs</a> -&gt; <a href="RdrName.html#t:GlobalRdrEnv">GlobalRdrEnv</a> -&gt; <a href="Type.html#t:Type">Type</a> -&gt; <a href="../base-4.10.1.0/Data-Maybe.html#t:Maybe">Maybe</a> ((<a href="Bag.html#t:Bag">Bag</a> <a href="RdrName.html#t:GlobalRdrElt">GlobalRdrElt</a>, <a href="TcEvidence.html#t:TcCoercion">TcCoercion</a>), <a href="Type.html#t:Type">Type</a>)</li><li class="src short"><a href="#v:checkRecFamInstConsistency">checkRecFamInstConsistency</a> :: <a href="TyCon.html#t:TyCon">TyCon</a> -&gt; <a href="TcRnTypes.html#t:TcM">TcM</a> ()</li><li class="src short"><a href="#v:newFamInst">newFamInst</a> :: <a href="FamInstEnv.html#t:FamFlavor">FamFlavor</a> -&gt; <a href="CoAxiom.html#t:CoAxiom">CoAxiom</a> <a href="CoAxiom.html#t:Unbranched">Unbranched</a> -&gt; <a href="TcRnTypes.html#t:TcRnIf">TcRnIf</a> gbl lcl <a href="FamInstEnv.html#t:FamInst">FamInst</a></li><li class="src short"><a href="#v:makeInjectivityErrors">makeInjectivityErrors</a> :: <a href="CoAxiom.html#t:CoAxiom">CoAxiom</a> br -&gt; <a href="CoAxiom.html#t:CoAxBranch">CoAxBranch</a> -&gt; [<a href="../base-4.10.1.0/Data-Bool.html#t:Bool">Bool</a>] -&gt; [<a href="CoAxiom.html#t:CoAxBranch">CoAxBranch</a>] -&gt; [(<a href="Outputable.html#t:SDoc">SDoc</a>, <a href="SrcLoc.html#t:SrcSpan">SrcSpan</a>)]</li><li class="src short"><a href="#v:injTyVarsOfType">injTyVarsOfType</a> :: <a href="TcType.html#t:TcTauType">TcTauType</a> -&gt; <a href="TcType.html#t:TcTyVarSet">TcTyVarSet</a></li><li class="src short"><a href="#v:injTyVarsOfTypes">injTyVarsOfTypes</a> :: [<a href="Type.html#t:Type">Type</a>] -&gt; <a href="VarSet.html#t:VarSet">VarSet</a></li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:FamInstEnvs" class="def">FamInstEnvs</a> = (<a href="FamInstEnv.html#t:FamInstEnv">FamInstEnv</a>, <a href="FamInstEnv.html#t:FamInstEnv">FamInstEnv</a>) <a href="src/FamInstEnv.html#FamInstEnvs" class="link">Source</a> <a href="#t:FamInstEnvs" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:tcGetFamInstEnvs" class="def">tcGetFamInstEnvs</a> :: <a href="TcRnTypes.html#t:TcM">TcM</a> <a href="FamInst.html#t:FamInstEnvs">FamInstEnvs</a> <a href="src/FamInst.html#tcGetFamInstEnvs" class="link">Source</a> <a href="#v:tcGetFamInstEnvs" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:checkFamInstConsistency" class="def">checkFamInstConsistency</a> :: [<a href="Module.html#t:Module">Module</a>] -&gt; [<a href="Module.html#t:Module">Module</a>] -&gt; <a href="TcRnTypes.html#t:TcM">TcM</a> <a href="TcRnTypes.html#t:TcGblEnv">TcGblEnv</a> <a href="src/FamInst.html#checkFamInstConsistency" class="link">Source</a> <a href="#v:checkFamInstConsistency" class="selflink">#</a></p><div class="doc"><p>Check family instance consistency, given:</p><ol><li>The list of all modules transitively imported by us
    which define a family instance (these are the ones
    we have to check for consistency), and</li><li>The list of modules which we directly imported
    (these specify the sets of family instance defining
    modules which are already known to be consistent).</li></ol><p>See Note [Checking family instance consistency] for more
 details, and Note [The type family instance consistency story]
 for the big picture.</p><p>This function doesn't check ALL instances for consistency,
 only ones that aren't involved in recursive knot-tying
 loops; see Note [Don't check hs-boot type family instances too early].
 It returns a modified <code><a href="TcRnTypes.html#t:TcGblEnv">TcGblEnv</a></code> that has saved the
 instances that need to be checked later; use <code><a href="FamInst.html#v:checkRecFamInstConsistency">checkRecFamInstConsistency</a></code>
 to check those.</p></div></div><div class="top"><p class="src"><a id="v:tcExtendLocalFamInstEnv" class="def">tcExtendLocalFamInstEnv</a> :: [<a href="FamInstEnv.html#t:FamInst">FamInst</a>] -&gt; <a href="TcRnTypes.html#t:TcM">TcM</a> a -&gt; <a href="TcRnTypes.html#t:TcM">TcM</a> a <a href="src/FamInst.html#tcExtendLocalFamInstEnv" class="link">Source</a> <a href="#v:tcExtendLocalFamInstEnv" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:tcLookupDataFamInst" class="def">tcLookupDataFamInst</a> :: <a href="FamInst.html#t:FamInstEnvs">FamInstEnvs</a> -&gt; <a href="TyCon.html#t:TyCon">TyCon</a> -&gt; [<a href="TcType.html#t:TcType">TcType</a>] -&gt; (<a href="TyCon.html#t:TyCon">TyCon</a>, [<a href="TcType.html#t:TcType">TcType</a>], <a href="Coercion.html#t:Coercion">Coercion</a>) <a href="src/FamInst.html#tcLookupDataFamInst" class="link">Source</a> <a href="#v:tcLookupDataFamInst" class="selflink">#</a></p><div class="doc"><p>Like <code><a href="FamInst.html#v:tcLookupDataFamInst_maybe">tcLookupDataFamInst_maybe</a></code>, but returns the arguments back if
 there is no data family to unwrap.
 Returns a Representational coercion</p></div></div><div class="top"><p class="src"><a id="v:tcLookupDataFamInst_maybe" class="def">tcLookupDataFamInst_maybe</a> :: <a href="FamInst.html#t:FamInstEnvs">FamInstEnvs</a> -&gt; <a href="TyCon.html#t:TyCon">TyCon</a> -&gt; [<a href="TcType.html#t:TcType">TcType</a>] -&gt; <a href="../base-4.10.1.0/Data-Maybe.html#t:Maybe">Maybe</a> (<a href="TyCon.html#t:TyCon">TyCon</a>, [<a href="TcType.html#t:TcType">TcType</a>], <a href="Coercion.html#t:Coercion">Coercion</a>) <a href="src/FamInst.html#tcLookupDataFamInst_maybe" class="link">Source</a> <a href="#v:tcLookupDataFamInst_maybe" class="selflink">#</a></p><div class="doc"><p>Converts a data family type (eg F [a]) to its representation type (eg FList a)
 and returns a coercion between the two: co :: F [a] ~R FList a.</p></div></div><div class="top"><p class="src"><a id="v:tcInstNewTyCon_maybe" class="def">tcInstNewTyCon_maybe</a> :: <a href="TyCon.html#t:TyCon">TyCon</a> -&gt; [<a href="TcType.html#t:TcType">TcType</a>] -&gt; <a href="../base-4.10.1.0/Data-Maybe.html#t:Maybe">Maybe</a> (<a href="TcType.html#t:TcType">TcType</a>, <a href="TcEvidence.html#t:TcCoercion">TcCoercion</a>) <a href="src/FamInst.html#tcInstNewTyCon_maybe" class="link">Source</a> <a href="#v:tcInstNewTyCon_maybe" class="selflink">#</a></p><div class="doc"><p>If <code>co :: T ts ~ rep_ty</code> then:</p><pre>instNewTyCon_maybe T ts = Just (rep_ty, co)</pre><p>Checks for a newtype, and for being saturated
 Just like Coercion.instNewTyCon_maybe, but returns a TcCoercion</p></div></div><div class="top"><p class="src"><a id="v:tcTopNormaliseNewTypeTF_maybe" class="def">tcTopNormaliseNewTypeTF_maybe</a> :: <a href="FamInst.html#t:FamInstEnvs">FamInstEnvs</a> -&gt; <a href="RdrName.html#t:GlobalRdrEnv">GlobalRdrEnv</a> -&gt; <a href="Type.html#t:Type">Type</a> -&gt; <a href="../base-4.10.1.0/Data-Maybe.html#t:Maybe">Maybe</a> ((<a href="Bag.html#t:Bag">Bag</a> <a href="RdrName.html#t:GlobalRdrElt">GlobalRdrElt</a>, <a href="TcEvidence.html#t:TcCoercion">TcCoercion</a>), <a href="Type.html#t:Type">Type</a>) <a href="src/FamInst.html#tcTopNormaliseNewTypeTF_maybe" class="link">Source</a> <a href="#v:tcTopNormaliseNewTypeTF_maybe" class="selflink">#</a></p><div class="doc"><p><code><a href="FamInst.html#v:tcTopNormaliseNewTypeTF_maybe">tcTopNormaliseNewTypeTF_maybe</a></code> gets rid of top-level newtypes,
 potentially looking through newtype <em>instances</em>.</p><p>It is only used by the type inference engine (specifically, when
 solving representational equality), and hence it is careful to unwrap
 only if the relevant data constructor is in scope.  That's why
 it get a GlobalRdrEnv argument.</p><p>It is careful not to unwrap data/newtype instances if it can't
 continue unwrapping.  Such care is necessary for proper error
 messages.</p><p>It does not look through type families.
 It does not normalise arguments to a tycon.</p><p>If the result is Just (rep_ty, (co, gres), rep_ty), then
    co : ty ~R rep_ty
    gres are the GREs for the data constructors that
                          had to be in scope</p></div></div><div class="top"><p class="src"><a id="v:checkRecFamInstConsistency" class="def">checkRecFamInstConsistency</a> :: <a href="TyCon.html#t:TyCon">TyCon</a> -&gt; <a href="TcRnTypes.html#t:TcM">TcM</a> () <a href="src/FamInst.html#checkRecFamInstConsistency" class="link">Source</a> <a href="#v:checkRecFamInstConsistency" class="selflink">#</a></p><div class="doc"><p>Given a <code><a href="TyCon.html#t:TyCon">TyCon</a></code> that has been incorporated into the type
 environment (the knot is tied), if it is a type family, check
 that all deferred instances for it are consistent.
 See Note [Don't check hs-boot type family instances too early]</p></div></div><div class="top"><p class="src"><a id="v:newFamInst" class="def">newFamInst</a> :: <a href="FamInstEnv.html#t:FamFlavor">FamFlavor</a> -&gt; <a href="CoAxiom.html#t:CoAxiom">CoAxiom</a> <a href="CoAxiom.html#t:Unbranched">Unbranched</a> -&gt; <a href="TcRnTypes.html#t:TcRnIf">TcRnIf</a> gbl lcl <a href="FamInstEnv.html#t:FamInst">FamInst</a> <a href="src/FamInst.html#newFamInst" class="link">Source</a> <a href="#v:newFamInst" class="selflink">#</a></p></div><h1 id="g:1">Injectivity</h1><div class="top"><p class="src"><a id="v:makeInjectivityErrors" class="def">makeInjectivityErrors</a> <a href="src/FamInst.html#makeInjectivityErrors" class="link">Source</a> <a href="#v:makeInjectivityErrors" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="CoAxiom.html#t:CoAxiom">CoAxiom</a> br</td><td class="doc"><p>Type family for which we generate errors</p></td></tr><tr><td class="src">-&gt; <a href="CoAxiom.html#t:CoAxBranch">CoAxBranch</a></td><td class="doc"><p>Currently checked equation (represented by axiom)</p></td></tr><tr><td class="src">-&gt; [<a href="../base-4.10.1.0/Data-Bool.html#t:Bool">Bool</a>]</td><td class="doc"><p>Injectivity annotation</p></td></tr><tr><td class="src">-&gt; [<a href="CoAxiom.html#t:CoAxBranch">CoAxBranch</a>]</td><td class="doc"><p>List of injectivity conflicts</p></td></tr><tr><td class="src">-&gt; [(<a href="Outputable.html#t:SDoc">SDoc</a>, <a href="SrcLoc.html#t:SrcSpan">SrcSpan</a>)]</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Build a list of injectivity errors together with their source locations.</p></div></div><div class="top"><p class="src"><a id="v:injTyVarsOfType" class="def">injTyVarsOfType</a> :: <a href="TcType.html#t:TcTauType">TcTauType</a> -&gt; <a href="TcType.html#t:TcTyVarSet">TcTyVarSet</a> <a href="src/FamInst.html#injTyVarsOfType" class="link">Source</a> <a href="#v:injTyVarsOfType" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:injTyVarsOfTypes" class="def">injTyVarsOfTypes</a> :: [<a href="Type.html#t:Type">Type</a>] -&gt; <a href="VarSet.html#t:VarSet">VarSet</a> <a href="src/FamInst.html#injTyVarsOfTypes" class="link">Source</a> <a href="#v:injTyVarsOfTypes" class="selflink">#</a></p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.18.1</p></div></body></html>