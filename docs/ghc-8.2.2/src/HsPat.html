<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>hsSyn/HsPat.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-
<a name="line-2"></a>(c) The University of Glasgow 2006
<a name="line-3"></a>(c) The GRASP/AQUA Project, Glasgow University, 1992-1998
<a name="line-4"></a>
<a name="line-5"></a>\section[PatSyntax]{Abstract Haskell syntax---patterns}
<a name="line-6"></a>-}</span>
<a name="line-7"></a>
<a name="line-8"></a><span class='hs-comment'>{-# LANGUAGE DeriveDataTypeable #-}</span>
<a name="line-9"></a><span class='hs-comment'>{-# LANGUAGE DeriveFunctor #-}</span>
<a name="line-10"></a><span class='hs-comment'>{-# LANGUAGE DeriveFoldable #-}</span>
<a name="line-11"></a><span class='hs-comment'>{-# LANGUAGE DeriveTraversable #-}</span>
<a name="line-12"></a><span class='hs-comment'>{-# LANGUAGE StandaloneDeriving #-}</span>
<a name="line-13"></a><span class='hs-comment'>{-# LANGUAGE FlexibleContexts #-}</span>
<a name="line-14"></a><span class='hs-comment'>{-# LANGUAGE UndecidableInstances #-}</span> <span class='hs-comment'>-- Note [Pass sensitive types]</span>
<a name="line-15"></a>                                      <span class='hs-comment'>-- in module PlaceHolder</span>
<a name="line-16"></a><span class='hs-comment'>{-# LANGUAGE ConstraintKinds #-}</span>
<a name="line-17"></a><span class='hs-comment'>{-# LANGUAGE TypeFamilies #-}</span>
<a name="line-18"></a>
<a name="line-19"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>HsPat</span> <span class='hs-layout'>(</span>
<a name="line-20"></a>        <span class='hs-conid'>Pat</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>InPat</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutPat</span><span class='hs-layout'>,</span> <span class='hs-conid'>LPat</span><span class='hs-layout'>,</span>
<a name="line-21"></a>
<a name="line-22"></a>        <span class='hs-conid'>HsConPatDetails</span><span class='hs-layout'>,</span> <span class='hs-varid'>hsConPatArgs</span><span class='hs-layout'>,</span>
<a name="line-23"></a>        <span class='hs-conid'>HsRecFields</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>HsRecField'</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LHsRecField'</span><span class='hs-layout'>,</span>
<a name="line-24"></a>        <span class='hs-conid'>HsRecField</span><span class='hs-layout'>,</span> <span class='hs-conid'>LHsRecField</span><span class='hs-layout'>,</span>
<a name="line-25"></a>        <span class='hs-conid'>HsRecUpdField</span><span class='hs-layout'>,</span> <span class='hs-conid'>LHsRecUpdField</span><span class='hs-layout'>,</span>
<a name="line-26"></a>        <span class='hs-varid'>hsRecFields</span><span class='hs-layout'>,</span> <span class='hs-varid'>hsRecFieldSel</span><span class='hs-layout'>,</span> <span class='hs-varid'>hsRecFieldId</span><span class='hs-layout'>,</span> <span class='hs-varid'>hsRecFieldsArgs</span><span class='hs-layout'>,</span>
<a name="line-27"></a>        <span class='hs-varid'>hsRecUpdFieldId</span><span class='hs-layout'>,</span> <span class='hs-varid'>hsRecUpdFieldOcc</span><span class='hs-layout'>,</span> <span class='hs-varid'>hsRecUpdFieldRdr</span><span class='hs-layout'>,</span>
<a name="line-28"></a>
<a name="line-29"></a>        <span class='hs-varid'>mkPrefixConPat</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkCharLitPat</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkNilPat</span><span class='hs-layout'>,</span>
<a name="line-30"></a>
<a name="line-31"></a>        <span class='hs-varid'>looksLazyPatBind</span><span class='hs-layout'>,</span>
<a name="line-32"></a>        <span class='hs-varid'>isBangedLPat</span><span class='hs-layout'>,</span> <span class='hs-varid'>isBangedPatBind</span><span class='hs-layout'>,</span>
<a name="line-33"></a>        <span class='hs-varid'>hsPatNeedsParens</span><span class='hs-layout'>,</span>
<a name="line-34"></a>        <span class='hs-varid'>isIrrefutableHsPat</span><span class='hs-layout'>,</span>
<a name="line-35"></a>
<a name="line-36"></a>        <span class='hs-varid'>collectEvVarsPats</span><span class='hs-layout'>,</span>
<a name="line-37"></a>
<a name="line-38"></a>        <span class='hs-varid'>pprParendLPat</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprConArgs</span>
<a name="line-39"></a>    <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-40"></a>
<a name="line-41"></a><span class='hs-keyword'>import</span> <span class='hs-comment'>{-# SOURCE #-}</span> <span class='hs-conid'>HsExpr</span>            <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span><span class='hs-layout'>,</span> <span class='hs-conid'>LHsExpr</span><span class='hs-layout'>,</span> <span class='hs-conid'>HsSplice</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprLExpr</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprSplice</span><span class='hs-layout'>)</span>
<a name="line-42"></a>
<a name="line-43"></a><span class='hs-comment'>-- friends:</span>
<a name="line-44"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>HsBinds</span>
<a name="line-45"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>HsLit</span>
<a name="line-46"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>PlaceHolder</span>
<a name="line-47"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>HsTypes</span>
<a name="line-48"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>TcEvidence</span>
<a name="line-49"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>BasicTypes</span>
<a name="line-50"></a><span class='hs-comment'>-- others:</span>
<a name="line-51"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>PprCore</span>          <span class='hs-layout'>(</span> <span class='hs-comment'>{- instance OutputableBndr TyVar -}</span> <span class='hs-layout'>)</span>
<a name="line-52"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>TysWiredIn</span>
<a name="line-53"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Var</span>
<a name="line-54"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>RdrName</span> <span class='hs-layout'>(</span> <span class='hs-conid'>RdrName</span> <span class='hs-layout'>)</span>
<a name="line-55"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>ConLike</span>
<a name="line-56"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>DataCon</span>
<a name="line-57"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>TyCon</span>
<a name="line-58"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Outputable</span>
<a name="line-59"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Type</span>
<a name="line-60"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>SrcLoc</span>
<a name="line-61"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Bag</span> <span class='hs-comment'>-- collect ev vars from pats</span>
<a name="line-62"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>DynFlags</span><span class='hs-layout'>(</span> <span class='hs-varid'>gopt</span><span class='hs-layout'>,</span> <span class='hs-conid'>GeneralFlag</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span> <span class='hs-layout'>)</span>
<a name="line-63"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Maybes</span>
<a name="line-64"></a><span class='hs-comment'>-- libraries:</span>
<a name="line-65"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Data</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyCon</span><span class='hs-layout'>,</span><span class='hs-conid'>Fixity</span><span class='hs-layout'>)</span>
<a name="line-66"></a>
<a name="line-67"></a><a name="InPat"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>InPat</span> <span class='hs-varid'>id</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span>        <span class='hs-comment'>-- No 'Out' constructors</span>
<a name="line-68"></a><a name="OutPat"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>OutPat</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span>        <span class='hs-comment'>-- No 'In' constructors</span>
<a name="line-69"></a>
<a name="line-70"></a><a name="LPat"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pat</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-71"></a>
<a name="line-72"></a><span class='hs-comment'>-- | Pattern</span>
<a name="line-73"></a><span class='hs-comment'>--</span>
<a name="line-74"></a><span class='hs-comment'>-- - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnBang'</span>
<a name="line-75"></a>
<a name="line-76"></a><a name="Pat"></a><span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-77"></a><a name="Pat"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Pat</span> <span class='hs-varid'>id</span>
<a name="line-78"></a>  <span class='hs-keyglyph'>=</span>     <span class='hs-comment'>------------ Simple patterns ---------------</span>
<a name="line-79"></a>    <span class='hs-conid'>WildPat</span>     <span class='hs-layout'>(</span><span class='hs-conid'>PostTc</span> <span class='hs-varid'>id</span> <span class='hs-conid'>Type</span><span class='hs-layout'>)</span>        <span class='hs-comment'>-- ^ Wildcard Pattern</span>
<a name="line-80"></a>        <span class='hs-comment'>-- The sole reason for a type on a WildPat is to</span>
<a name="line-81"></a>        <span class='hs-comment'>-- support hsPatType :: Pat Id -&gt; Type</span>
<a name="line-82"></a>
<a name="line-83"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>VarPat</span>      <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ Variable Pattern</span>
<a name="line-84"></a>
<a name="line-85"></a>                             <span class='hs-comment'>-- See Note [Located RdrNames] in HsExpr</span>
<a name="line-86"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LazyPat</span>     <span class='hs-layout'>(</span><span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>               <span class='hs-comment'>-- ^ Lazy Pattern</span>
<a name="line-87"></a>    <span class='hs-comment'>-- ^ - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnTilde'</span>
<a name="line-88"></a>
<a name="line-89"></a>    <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-90"></a>
<a name="line-91"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AsPat</span>       <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- ^ As pattern</span>
<a name="line-92"></a>    <span class='hs-comment'>-- ^ - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnAt'</span>
<a name="line-93"></a>
<a name="line-94"></a>    <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-95"></a>
<a name="line-96"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ParPat</span>      <span class='hs-layout'>(</span><span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>               <span class='hs-comment'>-- ^ Parenthesised pattern</span>
<a name="line-97"></a>                                        <span class='hs-comment'>-- See Note [Parens in HsSyn] in HsExpr</span>
<a name="line-98"></a>    <span class='hs-comment'>-- ^ - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnOpen' @'('@,</span>
<a name="line-99"></a>    <span class='hs-comment'>--                                    'ApiAnnotation.AnnClose' @')'@</span>
<a name="line-100"></a>
<a name="line-101"></a>    <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-102"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>BangPat</span>     <span class='hs-layout'>(</span><span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>               <span class='hs-comment'>-- ^ Bang pattern</span>
<a name="line-103"></a>    <span class='hs-comment'>-- ^ - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnBang'</span>
<a name="line-104"></a>
<a name="line-105"></a>    <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-106"></a>
<a name="line-107"></a>        <span class='hs-comment'>------------ Lists, tuples, arrays ---------------</span>
<a name="line-108"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ListPat</span>     <span class='hs-keyglyph'>[</span><span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span>
<a name="line-109"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>PostTc</span> <span class='hs-varid'>id</span> <span class='hs-conid'>Type</span><span class='hs-layout'>)</span>                        <span class='hs-comment'>-- The type of the elements</span>
<a name="line-110"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>PostTc</span> <span class='hs-varid'>id</span> <span class='hs-conid'>Type</span><span class='hs-layout'>,</span> <span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- For rebindable syntax</span>
<a name="line-111"></a>                   <span class='hs-comment'>-- For OverloadedLists a Just (ty,fn) gives</span>
<a name="line-112"></a>                   <span class='hs-comment'>-- overall type of the pattern, and the toList</span>
<a name="line-113"></a>                   <span class='hs-comment'>-- function to convert the scrutinee to a list value</span>
<a name="line-114"></a>    <span class='hs-comment'>-- ^ Syntactic List</span>
<a name="line-115"></a>    <span class='hs-comment'>--</span>
<a name="line-116"></a>    <span class='hs-comment'>-- - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnOpen' @'['@,</span>
<a name="line-117"></a>    <span class='hs-comment'>--                                    'ApiAnnotation.AnnClose' @']'@</span>
<a name="line-118"></a>
<a name="line-119"></a>    <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-120"></a>
<a name="line-121"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>TuplePat</span>    <span class='hs-keyglyph'>[</span><span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span>        <span class='hs-comment'>-- Tuple sub-patterns</span>
<a name="line-122"></a>                <span class='hs-conid'>Boxity</span>           <span class='hs-comment'>-- UnitPat is TuplePat []</span>
<a name="line-123"></a>                <span class='hs-keyglyph'>[</span><span class='hs-conid'>PostTc</span> <span class='hs-varid'>id</span> <span class='hs-conid'>Type</span><span class='hs-keyglyph'>]</span> <span class='hs-comment'>-- [] before typechecker, filled in afterwards</span>
<a name="line-124"></a>                                 <span class='hs-comment'>-- with the types of the tuple components</span>
<a name="line-125"></a>        <span class='hs-comment'>-- You might think that the PostTc id Type was redundant, because we can</span>
<a name="line-126"></a>        <span class='hs-comment'>-- get the pattern type by getting the types of the sub-patterns.</span>
<a name="line-127"></a>        <span class='hs-comment'>-- But it's essential</span>
<a name="line-128"></a>        <span class='hs-comment'>--      data T a where</span>
<a name="line-129"></a>        <span class='hs-comment'>--        T1 :: Int -&gt; T Int</span>
<a name="line-130"></a>        <span class='hs-comment'>--      f :: (T a, a) -&gt; Int</span>
<a name="line-131"></a>        <span class='hs-comment'>--      f (T1 x, z) = z</span>
<a name="line-132"></a>        <span class='hs-comment'>-- When desugaring, we must generate</span>
<a name="line-133"></a>        <span class='hs-comment'>--      f = /\a. \v::a.  case v of (t::T a, w::a) -&gt;</span>
<a name="line-134"></a>        <span class='hs-comment'>--                       case t of (T1 (x::Int)) -&gt;</span>
<a name="line-135"></a>        <span class='hs-comment'>-- Note the (w::a), NOT (w::Int), because we have not yet</span>
<a name="line-136"></a>        <span class='hs-comment'>-- refined 'a' to Int.  So we must know that the second component</span>
<a name="line-137"></a>        <span class='hs-comment'>-- of the tuple is of type 'a' not Int.  See selectMatchVar</span>
<a name="line-138"></a>        <span class='hs-comment'>-- (June 14: I'm not sure this comment is right; the sub-patterns</span>
<a name="line-139"></a>        <span class='hs-comment'>--           will be wrapped in CoPats, no?)</span>
<a name="line-140"></a>    <span class='hs-comment'>-- ^ Tuple sub-patterns</span>
<a name="line-141"></a>    <span class='hs-comment'>--</span>
<a name="line-142"></a>    <span class='hs-comment'>-- - 'ApiAnnotation.AnnKeywordId' :</span>
<a name="line-143"></a>    <span class='hs-comment'>--            'ApiAnnotation.AnnOpen' @'('@ or @'(#'@,</span>
<a name="line-144"></a>    <span class='hs-comment'>--            'ApiAnnotation.AnnClose' @')'@ or  @'#)'@</span>
<a name="line-145"></a>
<a name="line-146"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>SumPat</span>      <span class='hs-layout'>(</span><span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>          <span class='hs-comment'>-- Sum sub-pattern</span>
<a name="line-147"></a>                <span class='hs-conid'>ConTag</span>             <span class='hs-comment'>-- Alternative (one-based)</span>
<a name="line-148"></a>                <span class='hs-conid'>Arity</span>              <span class='hs-comment'>-- Arity</span>
<a name="line-149"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>PostTc</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Type</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- PlaceHolder before typechecker, filled in</span>
<a name="line-150"></a>                                   <span class='hs-comment'>-- afterwards with the types of the</span>
<a name="line-151"></a>                                   <span class='hs-comment'>-- alternative</span>
<a name="line-152"></a>    <span class='hs-comment'>-- ^ Anonymous sum pattern</span>
<a name="line-153"></a>    <span class='hs-comment'>--</span>
<a name="line-154"></a>    <span class='hs-comment'>-- - 'ApiAnnotation.AnnKeywordId' :</span>
<a name="line-155"></a>    <span class='hs-comment'>--            'ApiAnnotation.AnnOpen' @'(#'@,</span>
<a name="line-156"></a>    <span class='hs-comment'>--            'ApiAnnotation.AnnClose' @'#)'@</span>
<a name="line-157"></a>
<a name="line-158"></a>    <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-159"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>PArrPat</span>     <span class='hs-keyglyph'>[</span><span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span>               <span class='hs-comment'>-- Syntactic parallel array</span>
<a name="line-160"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>PostTc</span> <span class='hs-varid'>id</span> <span class='hs-conid'>Type</span><span class='hs-layout'>)</span>        <span class='hs-comment'>-- The type of the elements</span>
<a name="line-161"></a>    <span class='hs-comment'>-- ^ - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnOpen' @'[:'@,</span>
<a name="line-162"></a>    <span class='hs-comment'>--                                    'ApiAnnotation.AnnClose' @':]'@</span>
<a name="line-163"></a>
<a name="line-164"></a>    <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-165"></a>        <span class='hs-comment'>------------ Constructor patterns ---------------</span>
<a name="line-166"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ConPatIn</span>    <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-167"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>HsConPatDetails</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-168"></a>    <span class='hs-comment'>-- ^ Constructor Pattern In</span>
<a name="line-169"></a>
<a name="line-170"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ConPatOut</span> <span class='hs-layout'>{</span>
<a name="line-171"></a>        <span class='hs-varid'>pat_con</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Located</span> <span class='hs-conid'>ConLike</span><span class='hs-layout'>,</span>
<a name="line-172"></a>        <span class='hs-varid'>pat_arg_tys</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Type</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>          <span class='hs-comment'>-- The universal arg types, 1-1 with the universal</span>
<a name="line-173"></a>                                        <span class='hs-comment'>-- tyvars of the constructor/pattern synonym</span>
<a name="line-174"></a>                                        <span class='hs-comment'>--   Use (conLikeResTy pat_con pat_arg_tys) to get</span>
<a name="line-175"></a>                                        <span class='hs-comment'>--   the type of the pattern</span>
<a name="line-176"></a>
<a name="line-177"></a>        <span class='hs-varid'>pat_tvs</span>   <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyVar</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>           <span class='hs-comment'>-- Existentially bound type variables</span>
<a name="line-178"></a>                                        <span class='hs-comment'>-- in correctly-scoped order e.g. [k:*, x:k]</span>
<a name="line-179"></a>        <span class='hs-varid'>pat_dicts</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>EvVar</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>           <span class='hs-comment'>-- Ditto *coercion variables* and *dictionaries*</span>
<a name="line-180"></a>                                        <span class='hs-comment'>-- One reason for putting coercion variable here, I think,</span>
<a name="line-181"></a>                                        <span class='hs-comment'>--      is to ensure their kinds are zonked</span>
<a name="line-182"></a>
<a name="line-183"></a>        <span class='hs-varid'>pat_binds</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TcEvBinds</span><span class='hs-layout'>,</span>         <span class='hs-comment'>-- Bindings involving those dictionaries</span>
<a name="line-184"></a>        <span class='hs-varid'>pat_args</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsConPatDetails</span> <span class='hs-varid'>id</span><span class='hs-layout'>,</span>
<a name="line-185"></a>        <span class='hs-varid'>pat_wrap</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsWrapper</span>          <span class='hs-comment'>-- Extra wrapper to pass to the matcher</span>
<a name="line-186"></a>                                        <span class='hs-comment'>-- Only relevant for pattern-synonyms;</span>
<a name="line-187"></a>                                        <span class='hs-comment'>--   ignored for data cons</span>
<a name="line-188"></a>    <span class='hs-layout'>}</span>
<a name="line-189"></a>    <span class='hs-comment'>-- ^ Constructor Pattern Out</span>
<a name="line-190"></a>
<a name="line-191"></a>        <span class='hs-comment'>------------ View patterns ---------------</span>
<a name="line-192"></a>  <span class='hs-comment'>-- | - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnRarrow'</span>
<a name="line-193"></a>
<a name="line-194"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-195"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ViewPat</span>       <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-196"></a>                  <span class='hs-layout'>(</span><span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-197"></a>                  <span class='hs-layout'>(</span><span class='hs-conid'>PostTc</span> <span class='hs-varid'>id</span> <span class='hs-conid'>Type</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- The overall type of the pattern</span>
<a name="line-198"></a>                                    <span class='hs-comment'>-- (= the argument type of the view function)</span>
<a name="line-199"></a>                                    <span class='hs-comment'>-- for hsPatType.</span>
<a name="line-200"></a>    <span class='hs-comment'>-- ^ View Pattern</span>
<a name="line-201"></a>
<a name="line-202"></a>        <span class='hs-comment'>------------ Pattern splices ---------------</span>
<a name="line-203"></a>  <span class='hs-comment'>-- | - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnOpen' @'$('@</span>
<a name="line-204"></a>  <span class='hs-comment'>--        'ApiAnnotation.AnnClose' @')'@</span>
<a name="line-205"></a>
<a name="line-206"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-207"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>SplicePat</span>       <span class='hs-layout'>(</span><span class='hs-conid'>HsSplice</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- ^ Splice Pattern (Includes quasi-quotes)</span>
<a name="line-208"></a>
<a name="line-209"></a>        <span class='hs-comment'>------------ Literal and n+k patterns ---------------</span>
<a name="line-210"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LitPat</span>          <span class='hs-conid'>HsLit</span>               <span class='hs-comment'>-- ^ Literal Pattern</span>
<a name="line-211"></a>                                        <span class='hs-comment'>-- Used for *non-overloaded* literal patterns:</span>
<a name="line-212"></a>                                        <span class='hs-comment'>-- Int#, Char#, Int, Char, String, etc.</span>
<a name="line-213"></a>
<a name="line-214"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NPat</span>                <span class='hs-comment'>-- Natural Pattern</span>
<a name="line-215"></a>                        <span class='hs-comment'>-- Used for all overloaded literals,</span>
<a name="line-216"></a>                        <span class='hs-comment'>-- including overloaded strings with -XOverloadedStrings</span>
<a name="line-217"></a>                    <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsOverLit</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- ALWAYS positive</span>
<a name="line-218"></a>                    <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- Just (Name of 'negate') for negative</span>
<a name="line-219"></a>                                                <span class='hs-comment'>-- patterns, Nothing otherwise</span>
<a name="line-220"></a>                    <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>             <span class='hs-comment'>-- Equality checker, of type t-&gt;t-&gt;Bool</span>
<a name="line-221"></a>                    <span class='hs-layout'>(</span><span class='hs-conid'>PostTc</span> <span class='hs-varid'>id</span> <span class='hs-conid'>Type</span><span class='hs-layout'>)</span>            <span class='hs-comment'>-- Overall type of pattern. Might be</span>
<a name="line-222"></a>                                                <span class='hs-comment'>-- different than the literal's type</span>
<a name="line-223"></a>                                                <span class='hs-comment'>-- if (==) or negate changes the type</span>
<a name="line-224"></a>
<a name="line-225"></a>  <span class='hs-comment'>-- ^ Natural Pattern</span>
<a name="line-226"></a>  <span class='hs-comment'>--</span>
<a name="line-227"></a>  <span class='hs-comment'>-- - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnVal' @'+'@</span>
<a name="line-228"></a>
<a name="line-229"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-230"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NPlusKPat</span>       <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>        <span class='hs-comment'>-- n+k pattern</span>
<a name="line-231"></a>                    <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsOverLit</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- It'll always be an HsIntegral</span>
<a name="line-232"></a>                    <span class='hs-layout'>(</span><span class='hs-conid'>HsOverLit</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>      <span class='hs-comment'>-- See Note [NPlusK patterns] in TcPat</span>
<a name="line-233"></a>                     <span class='hs-comment'>-- NB: This could be (PostTc ...), but that induced a</span>
<a name="line-234"></a>                     <span class='hs-comment'>-- a new hs-boot file. Not worth it.</span>
<a name="line-235"></a>
<a name="line-236"></a>                    <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- (&gt;=) function, of type t1-&gt;t2-&gt;Bool</span>
<a name="line-237"></a>                    <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- Name of '-' (see RnEnv.lookupSyntaxName)</span>
<a name="line-238"></a>                    <span class='hs-layout'>(</span><span class='hs-conid'>PostTc</span> <span class='hs-varid'>id</span> <span class='hs-conid'>Type</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- Type of overall pattern</span>
<a name="line-239"></a>  <span class='hs-comment'>-- ^ n+k pattern</span>
<a name="line-240"></a>
<a name="line-241"></a>        <span class='hs-comment'>------------ Pattern type signatures ---------------</span>
<a name="line-242"></a>  <span class='hs-comment'>-- | - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnDcolon'</span>
<a name="line-243"></a>
<a name="line-244"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-245"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>SigPatIn</span>        <span class='hs-layout'>(</span><span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>                 <span class='hs-comment'>-- Pattern with a type signature</span>
<a name="line-246"></a>                    <span class='hs-layout'>(</span><span class='hs-conid'>LHsSigWcType</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>         <span class='hs-comment'>-- Signature can bind both</span>
<a name="line-247"></a>                                              <span class='hs-comment'>-- kind and type vars</span>
<a name="line-248"></a>    <span class='hs-comment'>-- ^ Pattern with a type signature</span>
<a name="line-249"></a>
<a name="line-250"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>SigPatOut</span>       <span class='hs-layout'>(</span><span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-251"></a>                    <span class='hs-conid'>Type</span>
<a name="line-252"></a>    <span class='hs-comment'>-- ^ Pattern with a type signature</span>
<a name="line-253"></a>
<a name="line-254"></a>        <span class='hs-comment'>------------ Pattern coercions (translation only) ---------------</span>
<a name="line-255"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>CoPat</span>       <span class='hs-conid'>HsWrapper</span>               <span class='hs-comment'>-- Coercion Pattern</span>
<a name="line-256"></a>                                        <span class='hs-comment'>-- If co :: t1 ~ t2, p :: t2,</span>
<a name="line-257"></a>                                        <span class='hs-comment'>-- then (CoPat co p) :: t1</span>
<a name="line-258"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>Pat</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>                <span class='hs-comment'>-- Why not LPat?  Ans: existing locn will do</span>
<a name="line-259"></a>                <span class='hs-conid'>Type</span>                    <span class='hs-comment'>-- Type of whole pattern, t1</span>
<a name="line-260"></a>        <span class='hs-comment'>-- During desugaring a (CoPat co pat) turns into a cast with 'co' on</span>
<a name="line-261"></a>        <span class='hs-comment'>-- the scrutinee, followed by a match on 'pat'</span>
<a name="line-262"></a>    <span class='hs-comment'>-- ^ Coercion Pattern</span>
<a name="line-263"></a><span class='hs-keyword'>deriving</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>DataId</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Data</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pat</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-264"></a>
<a name="line-265"></a><a name="HsConPatDetails"></a><span class='hs-comment'>-- | Haskell Constructor Pattern Details</span>
<a name="line-266"></a><a name="HsConPatDetails"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>HsConPatDetails</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsConDetails</span> <span class='hs-layout'>(</span><span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsRecFields</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-267"></a>
<a name="line-268"></a><a name="hsConPatArgs"></a><span class='hs-definition'>hsConPatArgs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsConPatDetails</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span>
<a name="line-269"></a><span class='hs-definition'>hsConPatArgs</span> <span class='hs-layout'>(</span><span class='hs-conid'>PrefixCon</span> <span class='hs-varid'>ps</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ps</span>
<a name="line-270"></a><span class='hs-definition'>hsConPatArgs</span> <span class='hs-layout'>(</span><span class='hs-conid'>RecCon</span> <span class='hs-varid'>fs</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsRecFieldArg</span> <span class='hs-varop'>.</span> <span class='hs-varid'>unLoc</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>rec_flds</span> <span class='hs-varid'>fs</span><span class='hs-layout'>)</span>
<a name="line-271"></a><span class='hs-definition'>hsConPatArgs</span> <span class='hs-layout'>(</span><span class='hs-conid'>InfixCon</span> <span class='hs-varid'>p1</span> <span class='hs-varid'>p2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>p1</span><span class='hs-layout'>,</span><span class='hs-varid'>p2</span><span class='hs-keyglyph'>]</span>
<a name="line-272"></a>
<a name="line-273"></a><a name="HsRecFields"></a><span class='hs-comment'>-- | Haskell Record Fields</span>
<a name="line-274"></a><a name="HsRecFields"></a><span class='hs-comment'>--</span>
<a name="line-275"></a><a name="HsRecFields"></a><span class='hs-comment'>-- HsRecFields is used only for patterns and expressions (not data type</span>
<a name="line-276"></a><a name="HsRecFields"></a><span class='hs-comment'>-- declarations)</span>
<a name="line-277"></a><a name="HsRecFields"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsRecFields</span> <span class='hs-varid'>id</span> <span class='hs-varid'>arg</span>         <span class='hs-comment'>-- A bunch of record fields</span>
<a name="line-278"></a>                                <span class='hs-comment'>--      { x = 3, y = True }</span>
<a name="line-279"></a>        <span class='hs-comment'>-- Used for both expressions and patterns</span>
<a name="line-280"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsRecFields</span> <span class='hs-layout'>{</span> <span class='hs-varid'>rec_flds</span>   <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsRecField</span> <span class='hs-varid'>id</span> <span class='hs-varid'>arg</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-281"></a>                  <span class='hs-varid'>rec_dotdot</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Int</span> <span class='hs-layout'>}</span>  <span class='hs-comment'>-- Note [DotDot fields]</span>
<a name="line-282"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Functor</span><span class='hs-layout'>,</span> <span class='hs-conid'>Foldable</span><span class='hs-layout'>,</span> <span class='hs-conid'>Traversable</span><span class='hs-layout'>)</span>
<a name="line-283"></a><span class='hs-keyword'>deriving</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>DataId</span> <span class='hs-varid'>id</span><span class='hs-layout'>,</span> <span class='hs-conid'>Data</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Data</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsRecFields</span> <span class='hs-varid'>id</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span>
<a name="line-284"></a>
<a name="line-285"></a>
<a name="line-286"></a><span class='hs-comment'>-- Note [DotDot fields]</span>
<a name="line-287"></a><span class='hs-comment'>-- ~~~~~~~~~~~~~~~~~~~~</span>
<a name="line-288"></a><span class='hs-comment'>-- The rec_dotdot field means this:</span>
<a name="line-289"></a><span class='hs-comment'>--   Nothing =&gt; the normal case</span>
<a name="line-290"></a><span class='hs-comment'>--   Just n  =&gt; the group uses ".." notation,</span>
<a name="line-291"></a><span class='hs-comment'>--</span>
<a name="line-292"></a><span class='hs-comment'>-- In the latter case:</span>
<a name="line-293"></a><span class='hs-comment'>--</span>
<a name="line-294"></a><span class='hs-comment'>--   *before* renamer: rec_flds are exactly the n user-written fields</span>
<a name="line-295"></a><span class='hs-comment'>--</span>
<a name="line-296"></a><span class='hs-comment'>--   *after* renamer:  rec_flds includes *all* fields, with</span>
<a name="line-297"></a><span class='hs-comment'>--                     the first 'n' being the user-written ones</span>
<a name="line-298"></a><span class='hs-comment'>--                     and the remainder being 'filled in' implicitly</span>
<a name="line-299"></a>
<a name="line-300"></a><a name="LHsRecField'"></a><span class='hs-comment'>-- | Located Haskell Record Field</span>
<a name="line-301"></a><a name="LHsRecField'"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LHsRecField'</span> <span class='hs-varid'>id</span> <span class='hs-varid'>arg</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsRecField'</span> <span class='hs-varid'>id</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span>
<a name="line-302"></a>
<a name="line-303"></a><a name="LHsRecField"></a><span class='hs-comment'>-- | Located Haskell Record Field</span>
<a name="line-304"></a><a name="LHsRecField"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LHsRecField</span>  <span class='hs-varid'>id</span> <span class='hs-varid'>arg</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsRecField</span>  <span class='hs-varid'>id</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span>
<a name="line-305"></a>
<a name="line-306"></a><a name="LHsRecUpdField"></a><span class='hs-comment'>-- | Located Haskell Record Update Field</span>
<a name="line-307"></a><a name="LHsRecUpdField"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LHsRecUpdField</span> <span class='hs-varid'>id</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsRecUpdField</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-308"></a>
<a name="line-309"></a><a name="HsRecField"></a><span class='hs-comment'>-- | Haskell Record Field</span>
<a name="line-310"></a><a name="HsRecField"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>HsRecField</span>    <span class='hs-varid'>id</span> <span class='hs-varid'>arg</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsRecField'</span> <span class='hs-layout'>(</span><span class='hs-conid'>FieldOcc</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-varid'>arg</span>
<a name="line-311"></a>
<a name="line-312"></a><a name="HsRecUpdField"></a><span class='hs-comment'>-- | Haskell Record Update Field</span>
<a name="line-313"></a><a name="HsRecUpdField"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>HsRecUpdField</span> <span class='hs-varid'>id</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsRecField'</span> <span class='hs-layout'>(</span><span class='hs-conid'>AmbiguousFieldOcc</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-314"></a>
<a name="line-315"></a><a name="HsRecField'"></a><span class='hs-comment'>-- | Haskell Record Field</span>
<a name="line-316"></a><a name="HsRecField'"></a><span class='hs-comment'>--</span>
<a name="line-317"></a><a name="HsRecField'"></a><span class='hs-comment'>-- - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnEqual',</span>
<a name="line-318"></a><a name="HsRecField'"></a><span class='hs-comment'>--</span>
<a name="line-319"></a><a name="HsRecField'"></a><span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-320"></a><a name="HsRecField'"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsRecField'</span> <span class='hs-varid'>id</span> <span class='hs-varid'>arg</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsRecField</span> <span class='hs-layout'>{</span>
<a name="line-321"></a>        <span class='hs-varid'>hsRecFieldLbl</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Located</span> <span class='hs-varid'>id</span><span class='hs-layout'>,</span>
<a name="line-322"></a>        <span class='hs-varid'>hsRecFieldArg</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>arg</span><span class='hs-layout'>,</span>           <span class='hs-comment'>-- ^ Filled in by renamer when punning</span>
<a name="line-323"></a>        <span class='hs-varid'>hsRecPun</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span>           <span class='hs-comment'>-- ^ Note [Punning]</span>
<a name="line-324"></a>  <span class='hs-layout'>}</span> <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Functor</span><span class='hs-layout'>,</span> <span class='hs-conid'>Foldable</span><span class='hs-layout'>,</span> <span class='hs-conid'>Traversable</span><span class='hs-layout'>)</span>
<a name="line-325"></a>
<a name="line-326"></a>
<a name="line-327"></a><span class='hs-comment'>-- Note [Punning]</span>
<a name="line-328"></a><span class='hs-comment'>-- ~~~~~~~~~~~~~~</span>
<a name="line-329"></a><span class='hs-comment'>-- If you write T { x, y = v+1 }, the HsRecFields will be</span>
<a name="line-330"></a><span class='hs-comment'>--      HsRecField x x True ...</span>
<a name="line-331"></a><span class='hs-comment'>--      HsRecField y (v+1) False ...</span>
<a name="line-332"></a><span class='hs-comment'>-- That is, for "punned" field x is expanded (in the renamer)</span>
<a name="line-333"></a><span class='hs-comment'>-- to x=x; but with a punning flag so we can detect it later</span>
<a name="line-334"></a><span class='hs-comment'>-- (e.g. when pretty printing)</span>
<a name="line-335"></a><span class='hs-comment'>--</span>
<a name="line-336"></a><span class='hs-comment'>-- If the original field was qualified, we un-qualify it, thus</span>
<a name="line-337"></a><span class='hs-comment'>--    T { A.x } means T { A.x = x }</span>
<a name="line-338"></a>
<a name="line-339"></a>
<a name="line-340"></a><span class='hs-comment'>-- Note [HsRecField and HsRecUpdField]</span>
<a name="line-341"></a><span class='hs-comment'>-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<a name="line-342"></a>
<a name="line-343"></a><span class='hs-comment'>-- A HsRecField (used for record construction and pattern matching)</span>
<a name="line-344"></a><span class='hs-comment'>-- contains an unambiguous occurrence of a field (i.e. a FieldOcc).</span>
<a name="line-345"></a><span class='hs-comment'>-- We can't just store the Name, because thanks to</span>
<a name="line-346"></a><span class='hs-comment'>-- DuplicateRecordFields this may not correspond to the label the user</span>
<a name="line-347"></a><span class='hs-comment'>-- wrote.</span>
<a name="line-348"></a><span class='hs-comment'>--</span>
<a name="line-349"></a><span class='hs-comment'>-- A HsRecUpdField (used for record update) contains a potentially</span>
<a name="line-350"></a><span class='hs-comment'>-- ambiguous occurrence of a field (an AmbiguousFieldOcc).  The</span>
<a name="line-351"></a><span class='hs-comment'>-- renamer will fill in the selector function if it can, but if the</span>
<a name="line-352"></a><span class='hs-comment'>-- selector is ambiguous the renamer will defer to the typechecker.</span>
<a name="line-353"></a><span class='hs-comment'>-- After the typechecker, a unique selector will have been determined.</span>
<a name="line-354"></a><span class='hs-comment'>--</span>
<a name="line-355"></a><span class='hs-comment'>-- The renamer produces an Unambiguous result if it can, rather than</span>
<a name="line-356"></a><span class='hs-comment'>-- just doing the lookup in the typechecker, so that completely</span>
<a name="line-357"></a><span class='hs-comment'>-- unambiguous updates can be represented by 'DsMeta.repUpdFields'.</span>
<a name="line-358"></a><span class='hs-comment'>--</span>
<a name="line-359"></a><span class='hs-comment'>-- For example, suppose we have:</span>
<a name="line-360"></a><span class='hs-comment'>--</span>
<a name="line-361"></a><span class='hs-comment'>--     data S = MkS { x :: Int }</span>
<a name="line-362"></a><span class='hs-comment'>--     data T = MkT { x :: Int }</span>
<a name="line-363"></a><span class='hs-comment'>--</span>
<a name="line-364"></a><span class='hs-comment'>--     f z = (z { x = 3 }) :: S</span>
<a name="line-365"></a><span class='hs-comment'>--</span>
<a name="line-366"></a><span class='hs-comment'>-- The parsed HsRecUpdField corresponding to the record update will have:</span>
<a name="line-367"></a><span class='hs-comment'>--</span>
<a name="line-368"></a><span class='hs-comment'>--     hsRecFieldLbl = Unambiguous "x" PlaceHolder :: AmbiguousFieldOcc RdrName</span>
<a name="line-369"></a><span class='hs-comment'>--</span>
<a name="line-370"></a><span class='hs-comment'>-- After the renamer, this will become:</span>
<a name="line-371"></a><span class='hs-comment'>--</span>
<a name="line-372"></a><span class='hs-comment'>--     hsRecFieldLbl = Ambiguous   "x" PlaceHolder :: AmbiguousFieldOcc Name</span>
<a name="line-373"></a><span class='hs-comment'>--</span>
<a name="line-374"></a><span class='hs-comment'>-- (note that the Unambiguous constructor is not type-correct here).</span>
<a name="line-375"></a><span class='hs-comment'>-- The typechecker will determine the particular selector:</span>
<a name="line-376"></a><span class='hs-comment'>--</span>
<a name="line-377"></a><span class='hs-comment'>--     hsRecFieldLbl = Unambiguous "x" $sel:x:MkS  :: AmbiguousFieldOcc Id</span>
<a name="line-378"></a><span class='hs-comment'>--</span>
<a name="line-379"></a><span class='hs-comment'>-- See also Note [Disambiguating record fields] in TcExpr.</span>
<a name="line-380"></a>
<a name="line-381"></a><a name="hsRecFields"></a><span class='hs-definition'>hsRecFields</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsRecFields</span> <span class='hs-varid'>id</span> <span class='hs-varid'>arg</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>PostRn</span> <span class='hs-varid'>id</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span>
<a name="line-382"></a><span class='hs-definition'>hsRecFields</span> <span class='hs-varid'>rbinds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varop'>.</span> <span class='hs-varid'>hsRecFieldSel</span> <span class='hs-varop'>.</span> <span class='hs-varid'>unLoc</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>rec_flds</span> <span class='hs-varid'>rbinds</span><span class='hs-layout'>)</span>
<a name="line-383"></a>
<a name="line-384"></a><a name="hsRecFieldsArgs"></a><span class='hs-comment'>-- Probably won't typecheck at once, things have changed :/</span>
<a name="line-385"></a><span class='hs-definition'>hsRecFieldsArgs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsRecFields</span> <span class='hs-varid'>id</span> <span class='hs-varid'>arg</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>arg</span><span class='hs-keyglyph'>]</span>
<a name="line-386"></a><span class='hs-definition'>hsRecFieldsArgs</span> <span class='hs-varid'>rbinds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsRecFieldArg</span> <span class='hs-varop'>.</span> <span class='hs-varid'>unLoc</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>rec_flds</span> <span class='hs-varid'>rbinds</span><span class='hs-layout'>)</span>
<a name="line-387"></a>
<a name="line-388"></a><a name="hsRecFieldSel"></a><span class='hs-definition'>hsRecFieldSel</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsRecField</span> <span class='hs-varid'>name</span> <span class='hs-varid'>arg</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>PostRn</span> <span class='hs-varid'>name</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-389"></a><span class='hs-definition'>hsRecFieldSel</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>selectorFieldOcc</span> <span class='hs-varop'>.</span> <span class='hs-varid'>hsRecFieldLbl</span>
<a name="line-390"></a>
<a name="line-391"></a><a name="hsRecFieldId"></a><span class='hs-definition'>hsRecFieldId</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsRecField</span> <span class='hs-conid'>Id</span> <span class='hs-varid'>arg</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Located</span> <span class='hs-conid'>Id</span>
<a name="line-392"></a><span class='hs-definition'>hsRecFieldId</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsRecFieldSel</span>
<a name="line-393"></a>
<a name="line-394"></a><a name="hsRecUpdFieldRdr"></a><span class='hs-definition'>hsRecUpdFieldRdr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsRecUpdField</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Located</span> <span class='hs-conid'>RdrName</span>
<a name="line-395"></a><span class='hs-definition'>hsRecUpdFieldRdr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>rdrNameAmbiguousFieldOcc</span> <span class='hs-varop'>.</span> <span class='hs-varid'>hsRecFieldLbl</span>
<a name="line-396"></a>
<a name="line-397"></a><a name="hsRecUpdFieldId"></a><span class='hs-definition'>hsRecUpdFieldId</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsRecField'</span> <span class='hs-layout'>(</span><span class='hs-conid'>AmbiguousFieldOcc</span> <span class='hs-conid'>Id</span><span class='hs-layout'>)</span> <span class='hs-varid'>arg</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Located</span> <span class='hs-conid'>Id</span>
<a name="line-398"></a><span class='hs-definition'>hsRecUpdFieldId</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>selectorFieldOcc</span> <span class='hs-varop'>.</span> <span class='hs-varid'>hsRecUpdFieldOcc</span>
<a name="line-399"></a>
<a name="line-400"></a><a name="hsRecUpdFieldOcc"></a><span class='hs-definition'>hsRecUpdFieldOcc</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsRecField'</span> <span class='hs-layout'>(</span><span class='hs-conid'>AmbiguousFieldOcc</span> <span class='hs-conid'>Id</span><span class='hs-layout'>)</span> <span class='hs-varid'>arg</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LFieldOcc</span> <span class='hs-conid'>Id</span>
<a name="line-401"></a><span class='hs-definition'>hsRecUpdFieldOcc</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>unambiguousFieldOcc</span> <span class='hs-varop'>.</span> <span class='hs-varid'>hsRecFieldLbl</span>
<a name="line-402"></a>
<a name="line-403"></a>
<a name="line-404"></a><span class='hs-comment'>{-
<a name="line-405"></a>************************************************************************
<a name="line-406"></a>*                                                                      *
<a name="line-407"></a>*              Printing patterns
<a name="line-408"></a>*                                                                      *
<a name="line-409"></a>************************************************************************
<a name="line-410"></a>-}</span>
<a name="line-411"></a>
<a name="line-412"></a><a name="instance%20Outputable%20(Pat%20name)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pat</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-413"></a>    <span class='hs-varid'>ppr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPat</span>
<a name="line-414"></a>
<a name="line-415"></a><a name="pprPatBndr"></a><span class='hs-definition'>pprPatBndr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-416"></a><span class='hs-definition'>pprPatBndr</span> <span class='hs-varid'>var</span>                  <span class='hs-comment'>-- Print with type info if -dppr-debug is on</span>
<a name="line-417"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getPprStyle</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span> <span class='hs-varid'>sty</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-418"></a>    <span class='hs-keyword'>if</span> <span class='hs-varid'>debugStyle</span> <span class='hs-varid'>sty</span> <span class='hs-keyword'>then</span>
<a name="line-419"></a>        <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprBndr</span> <span class='hs-conid'>LambdaBind</span> <span class='hs-varid'>var</span><span class='hs-layout'>)</span>         <span class='hs-comment'>-- Could pass the site to pprPat</span>
<a name="line-420"></a>                                                <span class='hs-comment'>-- but is it worth it?</span>
<a name="line-421"></a>    <span class='hs-keyword'>else</span>
<a name="line-422"></a>        <span class='hs-varid'>pprPrefixOcc</span> <span class='hs-varid'>var</span>
<a name="line-423"></a>
<a name="line-424"></a><a name="pprParendLPat"></a><span class='hs-definition'>pprParendLPat</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>LPat</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-425"></a><span class='hs-definition'>pprParendLPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprParendPat</span> <span class='hs-varid'>p</span>
<a name="line-426"></a>
<a name="line-427"></a><a name="pprParendPat"></a><span class='hs-definition'>pprParendPat</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Pat</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-428"></a><span class='hs-definition'>pprParendPat</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sdocWithDynFlags</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span> <span class='hs-varid'>dflags</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-429"></a>                 <span class='hs-keyword'>if</span> <span class='hs-varid'>need_parens</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>p</span>
<a name="line-430"></a>                 <span class='hs-keyword'>then</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprPat</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-431"></a>                 <span class='hs-keyword'>else</span>  <span class='hs-varid'>pprPat</span> <span class='hs-varid'>p</span>
<a name="line-432"></a>  <span class='hs-keyword'>where</span>
<a name="line-433"></a>    <span class='hs-varid'>need_parens</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>p</span>
<a name="line-434"></a>      <span class='hs-keyglyph'>|</span> <span class='hs-conid'>CoPat</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>gopt</span> <span class='hs-conid'>Opt_PrintTypecheckerElaboration</span> <span class='hs-varid'>dflags</span>
<a name="line-435"></a>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsPatNeedsParens</span> <span class='hs-varid'>p</span>
<a name="line-436"></a>      <span class='hs-comment'>-- For a CoPat we need parens if we are going to show it, which</span>
<a name="line-437"></a>      <span class='hs-comment'>-- we do if -fprint-typechecker-elaboration is on (c.f. pprHsWrapper)</span>
<a name="line-438"></a>      <span class='hs-comment'>-- But otherwise the CoPat is discarded, so it</span>
<a name="line-439"></a>      <span class='hs-comment'>-- is the pattern inside that matters.  Sigh.</span>
<a name="line-440"></a>
<a name="line-441"></a><a name="pprPat"></a><span class='hs-definition'>pprPat</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Pat</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-442"></a><span class='hs-definition'>pprPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>VarPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>var</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPatBndr</span> <span class='hs-varid'>var</span>
<a name="line-443"></a><span class='hs-definition'>pprPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>WildPat</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>            <span class='hs-keyglyph'>=</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'_'</span>
<a name="line-444"></a><span class='hs-definition'>pprPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>LazyPat</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'~'</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>pprParendLPat</span> <span class='hs-varid'>pat</span>
<a name="line-445"></a><span class='hs-definition'>pprPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>BangPat</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'!'</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>pprParendLPat</span> <span class='hs-varid'>pat</span>
<a name="line-446"></a><span class='hs-definition'>pprPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>AsPat</span> <span class='hs-varid'>name</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hcat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pprPrefixOcc</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'@'</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprParendLPat</span> <span class='hs-varid'>pat</span><span class='hs-keyglyph'>]</span>
<a name="line-447"></a><span class='hs-definition'>pprPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>ViewPat</span> <span class='hs-varid'>expr</span> <span class='hs-varid'>pat</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hcat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pprLExpr</span> <span class='hs-varid'>expr</span><span class='hs-layout'>,</span> <span class='hs-varid'>text</span> <span class='hs-str'>" -&gt; "</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>pat</span><span class='hs-keyglyph'>]</span>
<a name="line-448"></a><span class='hs-definition'>pprPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>ParPat</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span>
<a name="line-449"></a><span class='hs-definition'>pprPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitPat</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>             <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>s</span>
<a name="line-450"></a><span class='hs-definition'>pprPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>NPat</span> <span class='hs-varid'>l</span> <span class='hs-conid'>Nothing</span>  <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>l</span>
<a name="line-451"></a><span class='hs-definition'>pprPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>NPat</span> <span class='hs-varid'>l</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'-'</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>l</span>
<a name="line-452"></a><span class='hs-definition'>pprPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>NPlusKPat</span> <span class='hs-varid'>n</span> <span class='hs-varid'>k</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>=</span> <span class='hs-varid'>hcat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>n</span><span class='hs-layout'>,</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'+'</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>k</span><span class='hs-keyglyph'>]</span>
<a name="line-453"></a><span class='hs-definition'>pprPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>SplicePat</span> <span class='hs-varid'>splice</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprSplice</span> <span class='hs-varid'>splice</span>
<a name="line-454"></a><span class='hs-definition'>pprPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>CoPat</span> <span class='hs-varid'>co</span> <span class='hs-varid'>pat</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprHsWrapper</span> <span class='hs-varid'>co</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>parens</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>parens</span>
<a name="line-455"></a>                                                            <span class='hs-keyword'>then</span> <span class='hs-varid'>pprParendPat</span> <span class='hs-varid'>pat</span>
<a name="line-456"></a>                                                            <span class='hs-keyword'>else</span> <span class='hs-varid'>pprPat</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span>
<a name="line-457"></a><span class='hs-definition'>pprPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>SigPatIn</span> <span class='hs-varid'>pat</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>pat</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>dcolon</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ty</span>
<a name="line-458"></a><span class='hs-definition'>pprPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>SigPatOut</span> <span class='hs-varid'>pat</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>pat</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>dcolon</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ty</span>
<a name="line-459"></a><span class='hs-definition'>pprPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>ListPat</span> <span class='hs-varid'>pats</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>brackets</span> <span class='hs-layout'>(</span><span class='hs-varid'>interpp'SP</span> <span class='hs-varid'>pats</span><span class='hs-layout'>)</span>
<a name="line-460"></a><span class='hs-definition'>pprPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>PArrPat</span> <span class='hs-varid'>pats</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>paBrackets</span> <span class='hs-layout'>(</span><span class='hs-varid'>interpp'SP</span> <span class='hs-varid'>pats</span><span class='hs-layout'>)</span>
<a name="line-461"></a><span class='hs-definition'>pprPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>TuplePat</span> <span class='hs-varid'>pats</span> <span class='hs-varid'>bx</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tupleParens</span> <span class='hs-layout'>(</span><span class='hs-varid'>boxityTupleSort</span> <span class='hs-varid'>bx</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprWithCommas</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>pats</span><span class='hs-layout'>)</span>
<a name="line-462"></a><span class='hs-definition'>pprPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>SumPat</span> <span class='hs-varid'>pat</span> <span class='hs-varid'>alt</span> <span class='hs-varid'>arity</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sumParens</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprAlternative</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>pat</span> <span class='hs-varid'>alt</span> <span class='hs-varid'>arity</span><span class='hs-layout'>)</span>
<a name="line-463"></a><span class='hs-definition'>pprPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>ConPatIn</span> <span class='hs-varid'>con</span> <span class='hs-varid'>details</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprUserCon</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>con</span><span class='hs-layout'>)</span> <span class='hs-varid'>details</span>
<a name="line-464"></a><span class='hs-definition'>pprPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>ConPatOut</span> <span class='hs-layout'>{</span> <span class='hs-varid'>pat_con</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>con</span><span class='hs-layout'>,</span> <span class='hs-varid'>pat_tvs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tvs</span><span class='hs-layout'>,</span> <span class='hs-varid'>pat_dicts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>dicts</span><span class='hs-layout'>,</span>
<a name="line-465"></a>                    <span class='hs-varid'>pat_binds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>binds</span><span class='hs-layout'>,</span> <span class='hs-varid'>pat_args</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>details</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-466"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sdocWithDynFlags</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>dflags</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-467"></a>       <span class='hs-comment'>-- Tiresome; in TcBinds.tcRhs we print out a</span>
<a name="line-468"></a>       <span class='hs-comment'>-- typechecked Pat in an error message,</span>
<a name="line-469"></a>       <span class='hs-comment'>-- and we want to make sure it prints nicely</span>
<a name="line-470"></a>    <span class='hs-keyword'>if</span> <span class='hs-varid'>gopt</span> <span class='hs-conid'>Opt_PrintTypecheckerElaboration</span> <span class='hs-varid'>dflags</span> <span class='hs-keyword'>then</span>
<a name="line-471"></a>        <span class='hs-varid'>ppr</span> <span class='hs-varid'>con</span>
<a name="line-472"></a>          <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>braces</span> <span class='hs-layout'>(</span><span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>hsep</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>pprPatBndr</span> <span class='hs-layout'>(</span><span class='hs-varid'>tvs</span> <span class='hs-varop'>++</span> <span class='hs-varid'>dicts</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-473"></a>                         <span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>binds</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-474"></a>          <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprConArgs</span> <span class='hs-varid'>details</span>
<a name="line-475"></a>    <span class='hs-keyword'>else</span> <span class='hs-varid'>pprUserCon</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>con</span><span class='hs-layout'>)</span> <span class='hs-varid'>details</span>
<a name="line-476"></a>
<a name="line-477"></a>
<a name="line-478"></a><a name="pprUserCon"></a><span class='hs-definition'>pprUserCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>con</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-479"></a>           <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>con</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsConPatDetails</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-480"></a><span class='hs-definition'>pprUserCon</span> <span class='hs-varid'>c</span> <span class='hs-layout'>(</span><span class='hs-conid'>InfixCon</span> <span class='hs-varid'>p1</span> <span class='hs-varid'>p2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>p1</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprInfixOcc</span> <span class='hs-varid'>c</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>p2</span>
<a name="line-481"></a><span class='hs-definition'>pprUserCon</span> <span class='hs-varid'>c</span> <span class='hs-varid'>details</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPrefixOcc</span> <span class='hs-varid'>c</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprConArgs</span> <span class='hs-varid'>details</span>
<a name="line-482"></a>
<a name="line-483"></a><a name="pprConArgs"></a><span class='hs-definition'>pprConArgs</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsConPatDetails</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-484"></a><span class='hs-definition'>pprConArgs</span> <span class='hs-layout'>(</span><span class='hs-conid'>PrefixCon</span> <span class='hs-varid'>pats</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>pprParendLPat</span> <span class='hs-varid'>pats</span><span class='hs-layout'>)</span>
<a name="line-485"></a><span class='hs-definition'>pprConArgs</span> <span class='hs-layout'>(</span><span class='hs-conid'>InfixCon</span> <span class='hs-varid'>p1</span> <span class='hs-varid'>p2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pprParendLPat</span> <span class='hs-varid'>p1</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprParendLPat</span> <span class='hs-varid'>p2</span><span class='hs-keyglyph'>]</span>
<a name="line-486"></a><span class='hs-definition'>pprConArgs</span> <span class='hs-layout'>(</span><span class='hs-conid'>RecCon</span> <span class='hs-varid'>rpats</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>rpats</span>
<a name="line-487"></a>
<a name="line-488"></a><a name="instance%20Outputable%20(HsRecFields%20id%20arg)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Outputable</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span>
<a name="line-489"></a>      <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsRecFields</span> <span class='hs-varid'>id</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-490"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsRecFields</span> <span class='hs-layout'>{</span> <span class='hs-varid'>rec_flds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>flds</span><span class='hs-layout'>,</span> <span class='hs-varid'>rec_dotdot</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-491"></a>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>braces</span> <span class='hs-layout'>(</span><span class='hs-varid'>fsep</span> <span class='hs-layout'>(</span><span class='hs-varid'>punctuate</span> <span class='hs-varid'>comma</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>flds</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-492"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsRecFields</span> <span class='hs-layout'>{</span> <span class='hs-varid'>rec_flds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>flds</span><span class='hs-layout'>,</span> <span class='hs-varid'>rec_dotdot</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>n</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-493"></a>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>braces</span> <span class='hs-layout'>(</span><span class='hs-varid'>fsep</span> <span class='hs-layout'>(</span><span class='hs-varid'>punctuate</span> <span class='hs-varid'>comma</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-varid'>take</span> <span class='hs-varid'>n</span> <span class='hs-varid'>flds</span><span class='hs-layout'>)</span> <span class='hs-varop'>++</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>dotdot</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-494"></a>        <span class='hs-keyword'>where</span>
<a name="line-495"></a>          <span class='hs-varid'>dotdot</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>".."</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ifPprDebug</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-varid'>drop</span> <span class='hs-varid'>n</span> <span class='hs-varid'>flds</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-496"></a>
<a name="line-497"></a><a name="instance%20Outputable%20(HsRecField'%20id%20arg)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Outputable</span> <span class='hs-varid'>id</span><span class='hs-layout'>,</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span>
<a name="line-498"></a>      <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsRecField'</span> <span class='hs-varid'>id</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-499"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsRecField</span> <span class='hs-layout'>{</span> <span class='hs-varid'>hsRecFieldLbl</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span><span class='hs-layout'>,</span> <span class='hs-varid'>hsRecFieldArg</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>arg</span><span class='hs-layout'>,</span>
<a name="line-500"></a>                    <span class='hs-varid'>hsRecPun</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pun</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-501"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>f</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppUnless</span> <span class='hs-varid'>pun</span> <span class='hs-varop'>$</span> <span class='hs-varid'>equals</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span>
<a name="line-502"></a>
<a name="line-503"></a>
<a name="line-504"></a><span class='hs-comment'>{-
<a name="line-505"></a>************************************************************************
<a name="line-506"></a>*                                                                      *
<a name="line-507"></a>*              Building patterns
<a name="line-508"></a>*                                                                      *
<a name="line-509"></a>************************************************************************
<a name="line-510"></a>-}</span>
<a name="line-511"></a>
<a name="line-512"></a><a name="mkPrefixConPat"></a><span class='hs-definition'>mkPrefixConPat</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DataCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>OutPat</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Type</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>OutPat</span> <span class='hs-varid'>id</span>
<a name="line-513"></a><span class='hs-comment'>-- Make a vanilla Prefix constructor pattern</span>
<a name="line-514"></a><span class='hs-definition'>mkPrefixConPat</span> <span class='hs-varid'>dc</span> <span class='hs-varid'>pats</span> <span class='hs-varid'>tys</span>
<a name="line-515"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-varop'>$</span> <span class='hs-conid'>ConPatOut</span> <span class='hs-layout'>{</span> <span class='hs-varid'>pat_con</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>RealDataCon</span> <span class='hs-varid'>dc</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>pat_tvs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-varid'>pat_dicts</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span><span class='hs-layout'>,</span>
<a name="line-516"></a>                        <span class='hs-varid'>pat_binds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>emptyTcEvBinds</span><span class='hs-layout'>,</span> <span class='hs-varid'>pat_args</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>PrefixCon</span> <span class='hs-varid'>pats</span><span class='hs-layout'>,</span>
<a name="line-517"></a>                        <span class='hs-varid'>pat_arg_tys</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tys</span><span class='hs-layout'>,</span> <span class='hs-varid'>pat_wrap</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>idHsWrapper</span> <span class='hs-layout'>}</span>
<a name="line-518"></a>
<a name="line-519"></a><a name="mkNilPat"></a><span class='hs-definition'>mkNilPat</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Type</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>OutPat</span> <span class='hs-varid'>id</span>
<a name="line-520"></a><span class='hs-definition'>mkNilPat</span> <span class='hs-varid'>ty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrefixConPat</span> <span class='hs-varid'>nilDataCon</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ty</span><span class='hs-keyglyph'>]</span>
<a name="line-521"></a>
<a name="line-522"></a><a name="mkCharLitPat"></a><span class='hs-definition'>mkCharLitPat</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SourceText</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Char</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>OutPat</span> <span class='hs-varid'>id</span>
<a name="line-523"></a><span class='hs-definition'>mkCharLitPat</span> <span class='hs-varid'>src</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrefixConPat</span> <span class='hs-varid'>charDataCon</span>
<a name="line-524"></a>                                    <span class='hs-keyglyph'>[</span><span class='hs-varid'>noLoc</span> <span class='hs-varop'>$</span> <span class='hs-conid'>LitPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCharPrim</span> <span class='hs-varid'>src</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-conid'>[]</span>
<a name="line-525"></a>
<a name="line-526"></a><span class='hs-comment'>{-
<a name="line-527"></a>************************************************************************
<a name="line-528"></a>*                                                                      *
<a name="line-529"></a>* Predicates for checking things about pattern-lists in EquationInfo   *
<a name="line-530"></a>*                                                                      *
<a name="line-531"></a>************************************************************************
<a name="line-532"></a>
<a name="line-533"></a>\subsection[Pat-list-predicates]{Look for interesting things in patterns}
<a name="line-534"></a>
<a name="line-535"></a>Unlike in the Wadler chapter, where patterns are either ``variables''
<a name="line-536"></a>or ``constructors,'' here we distinguish between:
<a name="line-537"></a>\begin{description}
<a name="line-538"></a>\item[unfailable:]
<a name="line-539"></a>Patterns that cannot fail to match: variables, wildcards, and lazy
<a name="line-540"></a>patterns.
<a name="line-541"></a>
<a name="line-542"></a>These are the irrefutable patterns; the two other categories
<a name="line-543"></a>are refutable patterns.
<a name="line-544"></a>
<a name="line-545"></a>\item[constructor:]
<a name="line-546"></a>A non-literal constructor pattern (see next category).
<a name="line-547"></a>
<a name="line-548"></a>\item[literal patterns:]
<a name="line-549"></a>At least the numeric ones may be overloaded.
<a name="line-550"></a>\end{description}
<a name="line-551"></a>
<a name="line-552"></a>A pattern is in {\em exactly one} of the above three categories; `as'
<a name="line-553"></a>patterns are treated specially, of course.
<a name="line-554"></a>
<a name="line-555"></a>The 1.3 report defines what ``irrefutable'' and ``failure-free'' patterns are.
<a name="line-556"></a>-}</span>
<a name="line-557"></a>
<a name="line-558"></a><a name="isBangedPatBind"></a><span class='hs-definition'>isBangedPatBind</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsBind</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-559"></a><span class='hs-definition'>isBangedPatBind</span> <span class='hs-layout'>(</span><span class='hs-conid'>PatBind</span> <span class='hs-layout'>{</span><span class='hs-varid'>pat_lhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pat</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isBangedLPat</span> <span class='hs-varid'>pat</span>
<a name="line-560"></a><span class='hs-definition'>isBangedPatBind</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-561"></a>
<a name="line-562"></a><a name="isBangedLPat"></a><span class='hs-definition'>isBangedLPat</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-563"></a><span class='hs-definition'>isBangedLPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>ParPat</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isBangedLPat</span> <span class='hs-varid'>p</span>
<a name="line-564"></a><span class='hs-definition'>isBangedLPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>BangPat</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-565"></a><span class='hs-definition'>isBangedLPat</span> <span class='hs-keyword'>_</span>                  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-566"></a>
<a name="line-567"></a><a name="looksLazyPatBind"></a><span class='hs-definition'>looksLazyPatBind</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsBind</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-568"></a><span class='hs-comment'>-- Returns True of anything *except*</span>
<a name="line-569"></a><span class='hs-comment'>--     a StrictHsBind (as above) or</span>
<a name="line-570"></a><span class='hs-comment'>--     a VarPat</span>
<a name="line-571"></a><span class='hs-comment'>-- In particular, returns True of a pattern binding with a compound pattern, like (I# x)</span>
<a name="line-572"></a><span class='hs-comment'>-- Looks through AbsBinds</span>
<a name="line-573"></a><span class='hs-definition'>looksLazyPatBind</span> <span class='hs-layout'>(</span><span class='hs-conid'>PatBind</span> <span class='hs-layout'>{</span> <span class='hs-varid'>pat_lhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>p</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-574"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>looksLazyLPat</span> <span class='hs-varid'>p</span>
<a name="line-575"></a><span class='hs-definition'>looksLazyPatBind</span> <span class='hs-layout'>(</span><span class='hs-conid'>AbsBinds</span> <span class='hs-layout'>{</span> <span class='hs-varid'>abs_binds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>binds</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-576"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>anyBag</span> <span class='hs-layout'>(</span><span class='hs-varid'>looksLazyPatBind</span> <span class='hs-varop'>.</span> <span class='hs-varid'>unLoc</span><span class='hs-layout'>)</span> <span class='hs-varid'>binds</span>
<a name="line-577"></a><span class='hs-definition'>looksLazyPatBind</span> <span class='hs-layout'>(</span><span class='hs-conid'>AbsBindsSig</span> <span class='hs-layout'>{</span> <span class='hs-varid'>abs_sig_bind</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>bind</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-578"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>looksLazyPatBind</span> <span class='hs-varid'>bind</span>
<a name="line-579"></a><span class='hs-definition'>looksLazyPatBind</span> <span class='hs-keyword'>_</span>
<a name="line-580"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-581"></a>
<a name="line-582"></a><a name="looksLazyLPat"></a><span class='hs-definition'>looksLazyLPat</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-583"></a><span class='hs-definition'>looksLazyLPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>ParPat</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>             <span class='hs-keyglyph'>=</span> <span class='hs-varid'>looksLazyLPat</span> <span class='hs-varid'>p</span>
<a name="line-584"></a><span class='hs-definition'>looksLazyLPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>AsPat</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>            <span class='hs-keyglyph'>=</span> <span class='hs-varid'>looksLazyLPat</span> <span class='hs-varid'>p</span>
<a name="line-585"></a><span class='hs-definition'>looksLazyLPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>BangPat</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-586"></a><span class='hs-definition'>looksLazyLPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>VarPat</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>            <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-587"></a><span class='hs-definition'>looksLazyLPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>WildPat</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-588"></a><span class='hs-definition'>looksLazyLPat</span> <span class='hs-keyword'>_</span>                            <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-589"></a>
<a name="line-590"></a><a name="isIrrefutableHsPat"></a><span class='hs-definition'>isIrrefutableHsPat</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-591"></a><span class='hs-comment'>-- (isIrrefutableHsPat p) is true if matching against p cannot fail,</span>
<a name="line-592"></a><span class='hs-comment'>-- in the sense of falling through to the next pattern.</span>
<a name="line-593"></a><span class='hs-comment'>--      (NB: this is not quite the same as the (silly) defn</span>
<a name="line-594"></a><span class='hs-comment'>--      in 3.17.2 of the Haskell 98 report.)</span>
<a name="line-595"></a><span class='hs-comment'>--</span>
<a name="line-596"></a><span class='hs-comment'>-- WARNING: isIrrefutableHsPat returns False if it's in doubt.</span>
<a name="line-597"></a><span class='hs-comment'>-- Specifically on a ConPatIn, which is what it sees for a</span>
<a name="line-598"></a><span class='hs-comment'>-- (LPat Name) in the renamer, it doesn't know the size of the</span>
<a name="line-599"></a><span class='hs-comment'>-- constructor family, so it returns False.  Result: only</span>
<a name="line-600"></a><span class='hs-comment'>-- tuple patterns are considered irrefuable at the renamer stage.</span>
<a name="line-601"></a><span class='hs-comment'>--</span>
<a name="line-602"></a><span class='hs-comment'>-- But if it returns True, the pattern is definitely irrefutable</span>
<a name="line-603"></a><span class='hs-definition'>isIrrefutableHsPat</span> <span class='hs-varid'>pat</span>
<a name="line-604"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>pat</span>
<a name="line-605"></a>  <span class='hs-keyword'>where</span>
<a name="line-606"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go1</span> <span class='hs-varid'>pat</span>
<a name="line-607"></a>
<a name="line-608"></a>    <span class='hs-varid'>go1</span> <span class='hs-layout'>(</span><span class='hs-conid'>WildPat</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-609"></a>    <span class='hs-varid'>go1</span> <span class='hs-layout'>(</span><span class='hs-conid'>VarPat</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-610"></a>    <span class='hs-varid'>go1</span> <span class='hs-layout'>(</span><span class='hs-conid'>LazyPat</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-611"></a>    <span class='hs-varid'>go1</span> <span class='hs-layout'>(</span><span class='hs-conid'>BangPat</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>pat</span>
<a name="line-612"></a>    <span class='hs-varid'>go1</span> <span class='hs-layout'>(</span><span class='hs-conid'>CoPat</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>pat</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go1</span> <span class='hs-varid'>pat</span>
<a name="line-613"></a>    <span class='hs-varid'>go1</span> <span class='hs-layout'>(</span><span class='hs-conid'>ParPat</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>pat</span>
<a name="line-614"></a>    <span class='hs-varid'>go1</span> <span class='hs-layout'>(</span><span class='hs-conid'>AsPat</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>pat</span>
<a name="line-615"></a>    <span class='hs-varid'>go1</span> <span class='hs-layout'>(</span><span class='hs-conid'>ViewPat</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>pat</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>pat</span>
<a name="line-616"></a>    <span class='hs-varid'>go1</span> <span class='hs-layout'>(</span><span class='hs-conid'>SigPatIn</span> <span class='hs-varid'>pat</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>pat</span>
<a name="line-617"></a>    <span class='hs-varid'>go1</span> <span class='hs-layout'>(</span><span class='hs-conid'>SigPatOut</span> <span class='hs-varid'>pat</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>pat</span>
<a name="line-618"></a>    <span class='hs-varid'>go1</span> <span class='hs-layout'>(</span><span class='hs-conid'>TuplePat</span> <span class='hs-varid'>pats</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>all</span> <span class='hs-varid'>go</span> <span class='hs-varid'>pats</span>
<a name="line-619"></a>    <span class='hs-varid'>go1</span> <span class='hs-layout'>(</span><span class='hs-conid'>SumPat</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-620"></a>                    <span class='hs-comment'>-- See Note [Unboxed sum patterns aren't irrefutable]</span>
<a name="line-621"></a>    <span class='hs-varid'>go1</span> <span class='hs-layout'>(</span><span class='hs-conid'>ListPat</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-622"></a>    <span class='hs-varid'>go1</span> <span class='hs-layout'>(</span><span class='hs-conid'>PArrPat</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>     <span class='hs-comment'>-- ?</span>
<a name="line-623"></a>
<a name="line-624"></a>    <span class='hs-varid'>go1</span> <span class='hs-layout'>(</span><span class='hs-conid'>ConPatIn</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>     <span class='hs-comment'>-- Conservative</span>
<a name="line-625"></a>    <span class='hs-varid'>go1</span> <span class='hs-layout'>(</span><span class='hs-conid'>ConPatOut</span><span class='hs-layout'>{</span> <span class='hs-varid'>pat_con</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>RealDataCon</span> <span class='hs-varid'>con</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>pat_args</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>details</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-626"></a>        <span class='hs-keyglyph'>=</span>  <span class='hs-varid'>isJust</span> <span class='hs-layout'>(</span><span class='hs-varid'>tyConSingleDataCon_maybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>dataConTyCon</span> <span class='hs-varid'>con</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-627"></a>           <span class='hs-comment'>-- NB: tyConSingleDataCon_maybe, *not* isProductTyCon, because</span>
<a name="line-628"></a>           <span class='hs-comment'>-- the latter is false of existentials. See Trac #4439</span>
<a name="line-629"></a>        <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>all</span> <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsConPatArgs</span> <span class='hs-varid'>details</span><span class='hs-layout'>)</span>
<a name="line-630"></a>    <span class='hs-varid'>go1</span> <span class='hs-layout'>(</span><span class='hs-conid'>ConPatOut</span><span class='hs-layout'>{</span> <span class='hs-varid'>pat_con</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>PatSynCon</span> <span class='hs-sel'>_pat</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-631"></a>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span> <span class='hs-comment'>-- Conservative</span>
<a name="line-632"></a>
<a name="line-633"></a>    <span class='hs-varid'>go1</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitPat</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-634"></a>    <span class='hs-varid'>go1</span> <span class='hs-layout'>(</span><span class='hs-conid'>NPat</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-635"></a>    <span class='hs-varid'>go1</span> <span class='hs-layout'>(</span><span class='hs-conid'>NPlusKPat</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-636"></a>
<a name="line-637"></a>    <span class='hs-comment'>-- We conservatively assume that no TH splices are irrefutable</span>
<a name="line-638"></a>    <span class='hs-comment'>-- since we cannot know until the splice is evaluated.</span>
<a name="line-639"></a>    <span class='hs-varid'>go1</span> <span class='hs-layout'>(</span><span class='hs-conid'>SplicePat</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-640"></a>
<a name="line-641"></a><span class='hs-comment'>{- Note [Unboxed sum patterns aren't irrefutable]
<a name="line-642"></a>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-643"></a>Unlike unboxed tuples, unboxed sums are *not* irrefutable when used as
<a name="line-644"></a>patterns. A simple example that demonstrates this is from #14228:
<a name="line-645"></a>
<a name="line-646"></a>  pattern Just' x = (# x | #)
<a name="line-647"></a>  pattern Nothing' = (# | () #)
<a name="line-648"></a>
<a name="line-649"></a>  foo x = case x of
<a name="line-650"></a>    Nothing' -&gt; putStrLn "nothing"
<a name="line-651"></a>    Just'    -&gt; putStrLn "just"
<a name="line-652"></a>
<a name="line-653"></a>In foo, the pattern Nothing' (that is, (# x | #)) is certainly not irrefutable,
<a name="line-654"></a>as does not match an unboxed sum value of the same aritynamely, (# | y #)
<a name="line-655"></a>(covered by Just'). In fact, no unboxed sum pattern is irrefutable, since the
<a name="line-656"></a>minimum unboxed sum arity is 2.
<a name="line-657"></a>
<a name="line-658"></a>Failing to mark unboxed sum patterns as non-irrefutable would cause the Just'
<a name="line-659"></a>case in foo to be unreachable, as GHC would mistakenly believe that Nothing'
<a name="line-660"></a>is the only thing that could possibly be matched!
<a name="line-661"></a>-}</span>
<a name="line-662"></a>
<a name="line-663"></a><a name="hsPatNeedsParens"></a><span class='hs-definition'>hsPatNeedsParens</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Pat</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-664"></a><span class='hs-definition'>hsPatNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>NPlusKPat</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-665"></a><span class='hs-definition'>hsPatNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>SplicePat</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-666"></a><span class='hs-definition'>hsPatNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>ConPatIn</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>ds</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>conPatNeedsParens</span> <span class='hs-varid'>ds</span>
<a name="line-667"></a><span class='hs-definition'>hsPatNeedsParens</span> <span class='hs-varid'>p</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>ConPatOut</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>conPatNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-varid'>pat_args</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-668"></a><span class='hs-definition'>hsPatNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>SigPatIn</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-669"></a><span class='hs-definition'>hsPatNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>SigPatOut</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-670"></a><span class='hs-definition'>hsPatNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>ViewPat</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-671"></a><span class='hs-definition'>hsPatNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>CoPat</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>p</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsPatNeedsParens</span> <span class='hs-varid'>p</span>
<a name="line-672"></a><span class='hs-definition'>hsPatNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>WildPat</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-673"></a><span class='hs-definition'>hsPatNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>VarPat</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-674"></a><span class='hs-definition'>hsPatNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>LazyPat</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-675"></a><span class='hs-definition'>hsPatNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>BangPat</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-676"></a><span class='hs-definition'>hsPatNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>ParPat</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-677"></a><span class='hs-definition'>hsPatNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>AsPat</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>          <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-678"></a><span class='hs-definition'>hsPatNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>TuplePat</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-679"></a><span class='hs-definition'>hsPatNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>SumPat</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-680"></a><span class='hs-definition'>hsPatNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>ListPat</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-681"></a><span class='hs-definition'>hsPatNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>PArrPat</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-682"></a><span class='hs-definition'>hsPatNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitPat</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-683"></a><span class='hs-definition'>hsPatNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>NPat</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-684"></a>
<a name="line-685"></a><a name="conPatNeedsParens"></a><span class='hs-definition'>conPatNeedsParens</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsConDetails</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-686"></a><span class='hs-definition'>conPatNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>PrefixCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-687"></a><span class='hs-definition'>conPatNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>InfixCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-688"></a><span class='hs-definition'>conPatNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>RecCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-689"></a>
<a name="line-690"></a><span class='hs-comment'>{-
<a name="line-691"></a>% Collect all EvVars from all constructor patterns
<a name="line-692"></a>-}</span>
<a name="line-693"></a>
<a name="line-694"></a><a name="collectEvVarsPats"></a><span class='hs-comment'>-- May need to add more cases</span>
<a name="line-695"></a><span class='hs-definition'>collectEvVarsPats</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Pat</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bag</span> <span class='hs-conid'>EvVar</span>
<a name="line-696"></a><span class='hs-definition'>collectEvVarsPats</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unionManyBags</span> <span class='hs-varop'>.</span> <span class='hs-varid'>map</span> <span class='hs-varid'>collectEvVarsPat</span>
<a name="line-697"></a>
<a name="line-698"></a><a name="collectEvVarsLPat"></a><span class='hs-definition'>collectEvVarsLPat</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bag</span> <span class='hs-conid'>EvVar</span>
<a name="line-699"></a><span class='hs-definition'>collectEvVarsLPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>collectEvVarsPat</span> <span class='hs-varid'>pat</span>
<a name="line-700"></a>
<a name="line-701"></a><a name="collectEvVarsPat"></a><span class='hs-definition'>collectEvVarsPat</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Pat</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bag</span> <span class='hs-conid'>EvVar</span>
<a name="line-702"></a><span class='hs-definition'>collectEvVarsPat</span> <span class='hs-varid'>pat</span> <span class='hs-keyglyph'>=</span>
<a name="line-703"></a>  <span class='hs-keyword'>case</span> <span class='hs-varid'>pat</span> <span class='hs-keyword'>of</span>
<a name="line-704"></a>    <span class='hs-conid'>LazyPat</span>  <span class='hs-varid'>p</span>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>collectEvVarsLPat</span> <span class='hs-varid'>p</span>
<a name="line-705"></a>    <span class='hs-conid'>AsPat</span> <span class='hs-keyword'>_</span>  <span class='hs-varid'>p</span>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>collectEvVarsLPat</span> <span class='hs-varid'>p</span>
<a name="line-706"></a>    <span class='hs-conid'>ParPat</span>   <span class='hs-varid'>p</span>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>collectEvVarsLPat</span> <span class='hs-varid'>p</span>
<a name="line-707"></a>    <span class='hs-conid'>BangPat</span>  <span class='hs-varid'>p</span>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>collectEvVarsLPat</span> <span class='hs-varid'>p</span>
<a name="line-708"></a>    <span class='hs-conid'>ListPat</span>  <span class='hs-varid'>ps</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>unionManyBags</span> <span class='hs-varop'>$</span> <span class='hs-varid'>map</span> <span class='hs-varid'>collectEvVarsLPat</span> <span class='hs-varid'>ps</span>
<a name="line-709"></a>    <span class='hs-conid'>TuplePat</span> <span class='hs-varid'>ps</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>unionManyBags</span> <span class='hs-varop'>$</span> <span class='hs-varid'>map</span> <span class='hs-varid'>collectEvVarsLPat</span> <span class='hs-varid'>ps</span>
<a name="line-710"></a>    <span class='hs-conid'>SumPat</span> <span class='hs-varid'>p</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>collectEvVarsLPat</span> <span class='hs-varid'>p</span>
<a name="line-711"></a>    <span class='hs-conid'>PArrPat</span>  <span class='hs-varid'>ps</span> <span class='hs-keyword'>_</span>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>unionManyBags</span> <span class='hs-varop'>$</span> <span class='hs-varid'>map</span> <span class='hs-varid'>collectEvVarsLPat</span> <span class='hs-varid'>ps</span>
<a name="line-712"></a>    <span class='hs-conid'>ConPatOut</span> <span class='hs-layout'>{</span><span class='hs-varid'>pat_dicts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>dicts</span><span class='hs-layout'>,</span> <span class='hs-varid'>pat_args</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>args</span><span class='hs-layout'>}</span>
<a name="line-713"></a>                      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>unionBags</span> <span class='hs-layout'>(</span><span class='hs-varid'>listToBag</span> <span class='hs-varid'>dicts</span><span class='hs-layout'>)</span>
<a name="line-714"></a>                                   <span class='hs-varop'>$</span> <span class='hs-varid'>unionManyBags</span>
<a name="line-715"></a>                                   <span class='hs-varop'>$</span> <span class='hs-varid'>map</span> <span class='hs-varid'>collectEvVarsLPat</span>
<a name="line-716"></a>                                   <span class='hs-varop'>$</span> <span class='hs-varid'>hsConPatArgs</span> <span class='hs-varid'>args</span>
<a name="line-717"></a>    <span class='hs-conid'>SigPatOut</span> <span class='hs-varid'>p</span> <span class='hs-keyword'>_</span>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>collectEvVarsLPat</span> <span class='hs-varid'>p</span>
<a name="line-718"></a>    <span class='hs-conid'>CoPat</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>p</span> <span class='hs-keyword'>_</span>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>collectEvVarsPat</span>  <span class='hs-varid'>p</span>
<a name="line-719"></a>    <span class='hs-conid'>ConPatIn</span> <span class='hs-keyword'>_</span>  <span class='hs-keyword'>_</span>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"foldMapPatBag: ConPatIn"</span>
<a name="line-720"></a>    <span class='hs-conid'>SigPatIn</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"foldMapPatBag: SigPatIn"</span>
<a name="line-721"></a>    <span class='hs-sel'>_other_pat</span>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>emptyBag</span>
</pre></body>
</html>
